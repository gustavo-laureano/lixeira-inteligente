# üóëÔ∏è Lixeira Inteligente - Sistema YOLO para Raspberry Pi

Sistema de detec√ß√£o de objetos em tempo real usando YOLOv8, otimizado para Raspberry Pi com c√¢mera 480p e comunica√ß√£o com Arduino.

## üìã √çndice

- [Caracter√≠sticas](#caracter√≠sticas)
- [Classes Detectadas](#classes-detectadas)
- [Requisitos](#requisitos)
- [Instala√ß√£o](#instala√ß√£o)
- [Configura√ß√£o](#configura√ß√£o)
- [Uso](#uso)
- [Comunica√ß√£o com Arduino](#comunica√ß√£o-com-arduino)
- [Otimiza√ß√µes](#otimiza√ß√µes)
- [Troubleshooting](#troubleshooting)

## ‚ú® Caracter√≠sticas

- ‚ö° **Detec√ß√£o r√°pida** com YOLOv8-nano (otimizado para ARM)
- üìπ **C√¢mera 480p** (640x480) para melhor performance
- üîå **Comunica√ß√£o serial** com Arduino para controle de movimento
- üê≥ **Docker containerizado** para f√°cil deploy
- ‚öôÔ∏è **Configura√ß√£o via YAML** - f√°cil customiza√ß√£o
- üìä **Logging detalhado** para debug e monitoramento
- üéØ **Detec√ß√£o de m√∫ltiplas classes** (garrafas, copos, tigelas)
- ü§ñ **Modelo pr√©-treinado** - detecta 80 objetos do COCO dataset automaticamente

## üéØ Classes Detectadas

O YOLOv8 vem **pr√©-treinado** com o dataset COCO e j√° detecta **80 classes** automaticamente, sem necessidade de treinar nada!

### ‚úÖ Classes √öteis para Lixeira:

| Classe | Descri√ß√£o | Status |
|--------|-----------|--------|
| `bottle` | Garrafas PET, vidro | ‚úÖ Recomendado |
| `cup` | Copos, x√≠caras | ‚úÖ Recomendado |
| `bowl` | Tigelas, bowls | ‚úÖ Recomendado |
| `wine glass` | Ta√ßas, c√°lices | ‚ö™ Opcional |
| `fork`, `knife`, `spoon` | Talheres | ‚ö™ Opcional |
| `banana`, `apple`, `orange` | Frutas | ‚ö™ Opcional |
| `can` | Latas | ‚ùå **N√ÉO dispon√≠vel** |

> **‚ö†Ô∏è IMPORTANTE**: O dataset COCO **N√ÉO tem a classe "can" (lata)**. Latas cil√≠ndricas s√£o geralmente detectadas como `bottle`. Se precisar distinguir latas de garrafas, considere adicionar um sensor de metal ou treinar um modelo customizado.

### üìù Testar Classes Dispon√≠veis

Execute este comando para ver todas as 80 classes que o modelo detecta:

```bash
python3 test_yolo_classes.py
```

### üîç Classes COCO Completas (80 objetos):

```
person, bicycle, car, motorcycle, airplane, bus, train, truck, boat,
traffic light, fire hydrant, stop sign, parking meter, bench, bird,
cat, dog, horse, sheep, cow, elephant, bear, zebra, giraffe, backpack,
umbrella, handbag, tie, suitcase, frisbee, skis, snowboard, sports ball,
kite, baseball bat, baseball glove, skateboard, surfboard, tennis racket,
bottle, wine glass, cup, fork, knife, spoon, bowl, banana, apple,
sandwich, orange, broccoli, carrot, hot dog, pizza, donut, cake, chair,
couch, potted plant, bed, dining table, toilet, tv, laptop, mouse,
remote, keyboard, cell phone, microwave, oven, toaster, sink,
refrigerator, book, clock, vase, scissors, teddy bear, hair drier,
toothbrush
```

## üîß Requisitos

### Hardware
- **Raspberry Pi 3/4/5** (recomendado Pi 4 com 4GB RAM ou superior)
- **C√¢mera USB ou CSI** compat√≠vel com V4L2
- **Arduino** (qualquer modelo com comunica√ß√£o serial)
- **Cabo USB** para conex√£o Arduino-Raspberry
- **Cart√£o SD** de pelo menos 16GB (recomendado 32GB)

### Software
- **Raspberry Pi OS** (64-bit recomendado)
- **Docker** e **Docker Compose**
- **Git**

## üì• Instala√ß√£o

### 1. Preparar o Raspberry Pi

```bash
# Atualizar sistema
sudo apt update && sudo apt upgrade -y

# Instalar Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# Adicionar usu√°rio ao grupo docker
sudo usermod -aG docker $USER

# Instalar Docker Compose
sudo apt install docker-compose -y

# Reiniciar para aplicar mudan√ßas de grupo
sudo reboot
```

### 2. Clonar o Reposit√≥rio

```bash
cd ~
git clone https://github.com/gustavo-laureano/lixeira-inteligente.git
cd lixeira-inteligente
```

### 3. Criar Diret√≥rios Necess√°rios

```bash
mkdir -p logs models data
```

### 4. Verificar Dispositivos

```bash
# Verificar c√¢mera
ls -l /dev/video*

# Verificar porta serial do Arduino
ls -l /dev/ttyUSB* /dev/ttyACM*

# Testar c√¢mera (instale v4l-utils se necess√°rio)
sudo apt install v4l-utils
v4l2-ctl --list-devices
```

## ‚öôÔ∏è Configura√ß√£o

### 1. Editar config.yaml

Abra o arquivo `config.yaml` e ajuste conforme seu setup:

```yaml
camera:
  resolution: [640, 480]  # Resolu√ß√£o 480p
  fps: 30                  # FPS desejado
  device: 0                # Device da c√¢mera

serial:
  port: "/dev/ttyUSB0"    # Porta do Arduino
  baudrate: 9600           # Baudrate (igual ao Arduino)

detection:
  classes:                 # Classes a detectar
    - "bottle"
    - "cup"
    - "can"
  min_area: 1000          # √Årea m√≠nima em pixels
```

### 2. Ajustar docker-compose.yml

Verifique os dispositivos no `docker-compose.yml`:

```yaml
devices:
  - /dev/video0:/dev/video0      # Ajuste se necess√°rio
  - /dev/ttyUSB0:/dev/ttyUSB0    # Ajuste conforme sua porta
```

## üöÄ Uso

### Build da Imagem

```bash
docker-compose build
```

**Nota:** O primeiro build pode demorar 30-60 minutos no Raspberry Pi.

### Executar o Sistema

```bash
# Iniciar em background
docker-compose up -d

# Ver logs em tempo real
docker-compose logs -f

# Parar o sistema
docker-compose down
```

### Executar Sem Docker (Desenvolvimento)

```bash
# Instalar depend√™ncias
pip3 install -r requirements.txt

# Executar
python3 detect.py
```

## üîå Comunica√ß√£o com Arduino

### Formato dos Comandos

O sistema envia comandos no formato:

```
CLASSE:POSI√á√ÉO:DIST√ÇNCIA
```

**Posi√ß√µes:**
- `LEFT` - Objeto √† esquerda
- `CENTER` - Objeto no centro
- `RIGHT` - Objeto √† direita

**Dist√¢ncias (baseadas na √°rea do objeto em pixels):**
- `VERY_CLOSE` - Muito perto (√°rea > 50.000 pixels¬≤) ‚Üí **Arduino RECUA**
- `CLOSE` - Perto (√°rea > 20.000 pixels¬≤) ‚Üí Arduino para (objeto alcan√ßado)
- `MEDIUM` - Dist√¢ncia m√©dia (√°rea > 10.000 pixels¬≤) ‚Üí Arduino avan√ßa devagar
- `FAR` - Longe (√°rea < 10.000 pixels¬≤) ‚Üí Arduino avan√ßa r√°pido

Exemplos:
- `BOTTLE:LEFT:FAR` - Garrafa longe √† esquerda (vira esquerda + avan√ßa r√°pido)
- `CAN:CENTER:MEDIUM` - Lata m√©dia dist√¢ncia no centro (avan√ßa devagar)
- `CUP:RIGHT:CLOSE` - Copo perto √† direita (para/ajusta)
- `BOWL:CENTER:VERY_CLOSE` - Tigela muito perto no centro (**RECUA**)

### C√≥digo Arduino Exemplo

```cpp
void setup() {
  Serial.begin(9600);
  // Configurar seus motores aqui
}

void loop() {
  if (Serial.available() > 0) {
    String command = Serial.readStringUntil('\n');
    processCommand(command);
  }
}

void processCommand(String cmd) {
  // Parse: OBJETO:POSICAO:DISTANCIA
  int firstColon = cmd.indexOf(':');
  int secondColon = cmd.indexOf(':', firstColon + 1);
  
  String object = cmd.substring(0, firstColon);
  String position = cmd.substring(firstColon + 1, secondColon);
  String distance = cmd.substring(secondColon + 1);
  
  // L√≥gica baseada na DIST√ÇNCIA
  if (distance == "VERY_CLOSE") {
    // ‚¨ÖÔ∏è RECUAR - Objeto muito perto!
    moveBackward();
    
  } else if (distance == "CLOSE") {
    // ‚è∏Ô∏è PARAR - Objeto alcan√ßado!
    stopMotors();
    
  } else if (distance == "MEDIUM") {
    // üê¢ APROXIMAR DEVAGAR
    if (position == "LEFT") {
      turnLeft();
      moveForwardSlow();
    } else if (position == "RIGHT") {
      turnRight();
      moveForwardSlow();
    } else {
      moveForwardSlow();
    }
    
  } else if (distance == "FAR") {
    // üöÄ AVAN√áAR R√ÅPIDO
    if (position == "LEFT") {
      turnLeft();
      moveForwardFast();
    } else if (position == "RIGHT") {
      turnRight();
      moveForwardFast();
    } else {
      moveForwardFast();
    }
  }
  
  Serial.println("OK"); // Resposta
}
```

Veja o c√≥digo completo em [arduino_example.ino](arduino_example.ino).

## ‚ö° Otimiza√ß√µes para Performance

### 1. Usar Modelo Nano

O YOLOv8n (nano) √© o mais r√°pido. Modelos maiores s√£o muito lentos no Raspberry Pi:
- ‚úÖ `yolov8n.pt` - **Recomendado** (~10-15 FPS no Pi 4)
- ‚ö†Ô∏è `yolov8s.pt` - Mais lento (~3-5 FPS)
- ‚ùå `yolov8m.pt`, `yolov8l.pt` - Muito lentos

### 2. Reduzir Resolu√ß√£o

Se precisar de mais FPS, reduza a resolu√ß√£o:

```yaml
camera:
  resolution: [320, 240]  # QVGA - mais r√°pido
```

### 3. Skip Frames

Processe apenas alguns frames:

```yaml
performance:
  frame_skip: 2  # Processa 1 a cada 2 frames
```

### 4. Aumentar Confidence Threshold

Reduza falsos positivos aumentando a confian√ßa m√≠nima:

```yaml
yolo:
  confidence: 0.6  # Maior = menos detec√ß√µes mas mais precisas
```

### 5. Overclock do Raspberry Pi (Opcional)

**ATEN√á√ÉO:** Fa√ßa apenas se tiver boa ventila√ß√£o!

Edite `/boot/config.txt`:

```bash
# Para Raspberry Pi 4
over_voltage=6
arm_freq=2000
gpu_freq=750
```

## üêõ Troubleshooting

### C√¢mera n√£o detectada

```bash
# Verificar se c√¢mera est√° conectada
vcgencmd get_camera

# Testar c√¢mera
raspistill -o test.jpg  # Para c√¢mera CSI
fswebcam test.jpg       # Para c√¢mera USB

# Verificar permiss√µes
sudo chmod 666 /dev/video0
```

### Arduino n√£o comunica

```bash
# Verificar porta
ls -l /dev/ttyUSB* /dev/ttyACM*

# Adicionar permiss√µes
sudo usermod -aG dialout $USER

# Testar comunica√ß√£o
sudo apt install screen
screen /dev/ttyUSB0 9600
```

### Performance muito baixa

1. **Reduzir resolu√ß√£o** para 320x240
2. **Usar frame_skip** = 2 ou 3
3. **Aumentar min_area** para ignorar objetos pequenos
4. **Verificar temperatura**: `vcgencmd measure_temp`
5. **Adicionar dissipador de calor** e ventilador

### Docker build falha

```bash
# Limpar cache
docker system prune -a

# Build sem cache
docker-compose build --no-cache

# Verificar espa√ßo em disco
df -h
```

### Modelo YOLO n√£o baixa

```bash
# Baixar manualmente
cd models
wget https://github.com/ultralytics/assets/releases/download/v0.0.0/yolov8n.pt
```

## üìä Monitoramento

### Ver logs

```bash
# Logs em tempo real
docker-compose logs -f

# √öltimas 100 linhas
docker-compose logs --tail=100

# Arquivo de log
tail -f logs/detection.log
```

### Estat√≠sticas do Container

```bash
# Uso de recursos
docker stats lixeira-inteligente

# Informa√ß√µes do container
docker inspect lixeira-inteligente
```

## üîÑ Atualiza√ß√£o

```bash
# Parar sistema
docker-compose down

# Atualizar c√≥digo
git pull

# Rebuild e reiniciar
docker-compose up -d --build
```

## üìù Estrutura do Projeto

```
lixeira-inteligente/
‚îú‚îÄ‚îÄ Dockerfile              # Imagem Docker
‚îú‚îÄ‚îÄ docker-compose.yml      # Orquestra√ß√£o
‚îú‚îÄ‚îÄ detect.py              # Script principal
‚îú‚îÄ‚îÄ config.yaml            # Configura√ß√µes
‚îú‚îÄ‚îÄ requirements.txt       # Depend√™ncias Python
‚îú‚îÄ‚îÄ README.md             # Este arquivo
‚îú‚îÄ‚îÄ logs/                 # Logs do sistema
‚îú‚îÄ‚îÄ models/               # Modelos YOLO
‚îî‚îÄ‚îÄ data/                 # Dados e capturas
```

## ü§ù Contribuindo

Contribui√ß√µes s√£o bem-vindas! Por favor:

1. Fork o projeto
2. Crie uma branch para sua feature
3. Commit suas mudan√ßas
4. Push para a branch
5. Abra um Pull Request

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo LICENSE para detalhes.

## üë®‚Äçüíª Autor

**Gustavo Laureano**

- GitHub: [@gustavo-laureano](https://github.com/gustavo-laureano)

## üôè Agradecimentos

- [Ultralytics](https://github.com/ultralytics/ultralytics) pelo YOLOv8
- Comunidade Raspberry Pi
- Comunidade Arduino

---

**Dica:** Para melhor performance, use Raspberry Pi 4 com 4GB+ RAM e um bom sistema de refrigera√ß√£o! üå°Ô∏è
